C251 COMPILER V5.60.0,  init                                                               19/12/24  21:08:57  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE init
OBJECT MODULE PLACED IN .\Out_File\init.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Out_File\init.c XSMALL WARNINGLEVEL(3) OPTIMIZE(0,SPEED) BROWSE INCDIR
                    -(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\USER\inc;..
                    -\USER\src;..\..\Libraries\seekfree_components;.\Out_File) DEBUG PRINT(.\Out_File\init.lst) TABS(2) OBJECT(.\Out_File\ini
                    -t.obj) 

stmt  level    source

    1          #include "headfile.h"
    2          
    3          // ADC è¯»å–å€¼æ•°ç»„
    4          float adc[11] = {0}; // ç”¨äºå­˜å‚¨ ADC è¯»å–çš„å€¼
    5          
    6          // åˆå§‹åŒ–é™€èºä»ªçš„å˜é‡
    7          int init_gyro_x = 0, init_gyro_y = 0, init_gyro_z = 0; // é™€èºä»ªåˆå§‹åŒ–å€¼
    8          float new_gyro_x = 0, new_gyro_y = 0, new_gyro_z = 0; // æ–°çš„é™€èºä»ªå€¼
    9          float z_inc = 0, x_inc = 0, y_inc = 0; // å¢é‡å€¼
   10          float angle_x; // è§’åº¦å€¼
   11          
   12          // ä¸Šä¸€ä¸ªåŠ é€Ÿåº¦å’Œé™€èºä»ªå€¼
   13          float last_acc_x, last_acc_y, last_acc_z; 
   14          float last_gyro_x, last_gyro_y, last_gyro_z;
   15          
   16          // å½“å‰åŠ é€Ÿåº¦å’Œé™€èºä»ªå€¼
   17          float Xdata = 0.0, Ydata = 0.0, Zdata = 0.0; 
   18          float acc_x = 0.0, acc_y = 0.0, acc_z = 0.0; 
   19          float gyro_x = 0.0, gyro_y = 0.0, gyro_z = 0.0; 
   20          
   21          int text = 0; // æ–‡æœ¬æ ‡å¿—ä½
   22          float alpha = 0.3; // å¹³æ»‘å› å­
   23          
   24          char a = 0; // è®¡æ•°å™¨
   25          
   26          // PWM å˜é‡
   27          float r_pwm = 0.0, l_pwm = 0.0; // å³ç”µæœºå’Œå·¦ç”µæœºçš„ PWM å€¼
   28          float last_r_pwm = 0.0, last_l_pwm = 0.0; // ä¸Šä¸€ä¸ª PWM å€¼
   29          
   30          #define ADC_CHANNELS 7 // ADC é€šé“æ•°é‡
   31          const int adc_channels[ADC_CHANNELS] = {ADC0, ADC1, ADC2, ADC3, ADC4, ADC5, ADC6}; // ADC é€šé“æ•°ç»„
   32          
   33          void car_pre_init(void) // è½¦è¾†é¢„åˆå§‹åŒ–å‡½æ•°
   34          {
   35   1        // åˆå§‹åŒ– PID æ§åˆ¶å™¨
   36   1        PID_init(&mr_pid); // å³ç”µæœº PID
   37   1        PID_init(&ml_pid); // å·¦ç”µæœº PID
   38   1        PID_init(&R_pid); // å³è½® PID
   39   1        PID_init(&L_pid); // å·¦è½® PID
   40   1        PID_init(&turn_pid); // è½¬å‘ PID
   41   1      
   42   1        // è®¾ç½® PID å‚æ•°
   43   1        PID_Set(&R_pid, 200, 25, 17); // è®¾ç½®å³è½® PID å‚æ•°
   44   1        PID_Set(&L_pid, 200, 25, 17); // è®¾ç½®å·¦è½® PID å‚æ•°
   45   1        PID_Set(&w_pid, 0.7, 0.1, 0); // è®¾ç½®é€Ÿåº¦ PID å‚æ•°
   46   1        PID_turnSet(&turn_pid, 190, 5, 17, 24); // è®¾ç½®è½¬å‘ PID å‚æ•°
   47   1      
   48   1        // åˆå§‹åŒ– ADC
   49   1        for (int i = 0; i < ADC_CHANNELS; i++) {
*** ERROR C25 IN LINE 49 OF Out_File\init.c: syntax error near 'int'
*** ERROR C67 IN LINE 49 OF Out_File\init.c: 'i': undefined identifier
*** ERROR C67 IN LINE 49 OF Out_File\init.c: 'i': undefined identifier
   50   2          adc_init(adc_channels[i], ADC_SYSclk_DIV_2); // åˆå§‹åŒ–æ¯ä¸ª ADC é€šé“
*** ERROR C67 IN LINE 50 OF Out_File\init.c: 'i': undefined identifier
*** WARNING C96 IN LINE 50 OF Out_File\init.c: 'adc_init': too few actual parameters
   51   2        }
C251 COMPILER V5.60.0,  init                                                               19/12/24  21:08:57  PAGE 2   

   52   1        delay_ms(10); // å»¶è¿Ÿä»¥ç¡®ä¿åˆå§‹åŒ–å®Œæˆ
   53   1        
   54   1        // åˆå§‹åŒ– PWM
   55   1        pwm_init(MOTOR1, 15000, 0); // åˆå§‹åŒ–ç”µæœº1 PWM
   56   1        pwm_init(MOTOR2, 15000, 0); // åˆå§‹åŒ–ç”µæœº2 PWM
   57   1        delay_ms(10); // å»¶è¿Ÿä»¥ç¡®ä¿åˆå§‹åŒ–å®Œæˆ
   58   1        
   59   1        // åˆå§‹åŒ– IPS æ˜¾ç¤ºå™¨
   60   1        ips114_init(); // åˆå§‹åŒ– IPS æ˜¾ç¤ºå™¨
   61   1        
   62   1        // åˆå§‹åŒ–è®¡æ—¶å™¨
   63   1        ctimer_count_init(MOTOR1_ENCODER); // åˆå§‹åŒ–ç”µæœº1ç¼–ç å™¨
   64   1        ctimer_count_init(MOTOR2_ENCODER); // åˆå§‹åŒ–ç”µæœº2ç¼–ç å™¨
   65   1        delay_ms(30); // å»¶è¿Ÿä»¥ç¡®ä¿åˆå§‹åŒ–å®Œæˆ
   66   1        
   67   1        // åˆå§‹åŒ– Lidar ä¼ æ„Ÿå™¨
   68   1        Lidar1.Address = 0x10; // è®¾ç½® Lidar åœ°å€
   69   1        User_I2C_Init(); // åˆå§‹åŒ– I2C
   70   1        imu660ra_init(); // åˆå§‹åŒ– IMU ä¼ æ„Ÿå™¨
   71   1        target_speed_save = l_target_speed; // ä¿å­˜ç›®æ ‡é€Ÿåº¦
   72   1      
   73   1        return; // è¿”å›
   74   1      }
   75          
   76          void get_adc(void) // è·å– ADC å€¼
   77          {
   78   1        int adc_get_value[ADC_CHANNELS] = {0}; // å­˜å‚¨ ADC è¯»å–å€¼çš„æ•°ç»„
   79   1        for (int i = 0; i < 5; ++i) // è¯»å– 5 æ¬¡ ADC å€¼
*** ERROR C25 IN LINE 79 OF Out_File\init.c: syntax error near 'int'
*** ERROR C67 IN LINE 79 OF Out_File\init.c: 'i': undefined identifier
*** ERROR C67 IN LINE 79 OF Out_File\init.c: 'i': undefined identifier
*** ERROR C67 IN LINE 79 OF Out_File\init.c: 'i': undefined identifier
   80   1        {
   81   2          for (int j = 0; j < ADC_CHANNELS; ++j) {
*** ERROR C25 IN LINE 81 OF Out_File\init.c: syntax error near 'int'
*** ERROR C67 IN LINE 81 OF Out_File\init.c: 'j': undefined identifier
*** ERROR C67 IN LINE 81 OF Out_File\init.c: 'j': undefined identifier
*** ERROR C67 IN LINE 81 OF Out_File\init.c: 'j': undefined identifier
   82   3            adc_get_value[j] += adc_once(adc_channels[j], ADC_10BIT); // è¯»å–æ¯ä¸ª ADC é€šé“
*** ERROR C67 IN LINE 82 OF Out_File\init.c: 'j': undefined identifier
*** ERROR C67 IN LINE 82 OF Out_File\init.c: 'j': undefined identifier
   83   3          }
   84   2        }
   85   1        for (int k = 0; k < ADC_CHANNELS; ++k) // è®¡ç®—å¹³å‡å€¼
*** ERROR C25 IN LINE 85 OF Out_File\init.c: syntax error near 'int'
*** ERROR C67 IN LINE 85 OF Out_File\init.c: 'k': undefined identifier
*** ERROR C67 IN LINE 85 OF Out_File\init.c: 'k': undefined identifier
*** ERROR C67 IN LINE 85 OF Out_File\init.c: 'k': undefined identifier
   86   1        {
   87   2          adc[k] = (float)adc_get_value[k] / (5 * 1000.0f); // å°† ADC å€¼è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å­˜å‚¨
*** ERROR C67 IN LINE 87 OF Out_File\init.c: 'k': undefined identifier
*** ERROR C67 IN LINE 87 OF Out_File\init.c: 'k': undefined identifier
   88   2        }
   89   1      }
   90          
   91          // é™€èºä»ªåç§»åˆå§‹åŒ–
   92          void gyroOffsetInit(void) 
   93          {
   94   1        if (text == 0) // å¦‚æœæ–‡æœ¬æ ‡å¿—ä¸º 0
   95   1        {
   96   2          if (a < 100) // è®¡æ•°å™¨å°äº 100
   97   2          {
   98   3            imu660ra_get_acc(); // è·å–åŠ é€Ÿåº¦
   99   3            imu660ra_get_gyro(); // è·å–é™€èºä»ªæ•°æ®
  100   3            Xdata += imu660ra_gyro_x; // ç´¯åŠ é™€èºä»ª X è½´æ•°æ®
  101   3            delay_ms(5); // å»¶è¿Ÿ 5 æ¯«ç§’
C251 COMPILER V5.60.0,  init                                                               19/12/24  21:08:57  PAGE 3   

  102   3            a++; // è®¡æ•°å™¨åŠ  1
  103   3          }
  104   2          else if (a == 100) // å½“è®¡æ•°å™¨ç­‰äº 100
  105   2          {
  106   3            Xdata *= 0.01; // è®¡ç®—å¹³å‡å€¼
  107   3            ips_page = 1; // é‡ç½® IPS é¡µé¢
  108   3            a++; // è®¡æ•°å™¨åŠ  1
  109   3            text = 1; // æ›´æ–°æ–‡æœ¬æ ‡å¿—
  110   3          }
  111   2        }
  112   1        else if (text == 1) // å¦‚æœæ–‡æœ¬æ ‡å¿—ä¸º 1
  113   1        {
  114   2          imu660ra_get_acc(); // è·å–åŠ é€Ÿåº¦
  115   2          imu660ra_get_gyro(); // è·å–é™€èºä»ªæ•°æ®
  116   2          gyro_x = imu660ra_gyro_transition(imu660ra_gyro_x - Xdata) * alpha + last_gyro_x * (1 - alpha); // è®¡ç
             -®—å¹³æ»‘çš„é™€èºä»ª X è½´å€¼
  117   2          last_gyro_x = gyro_x; // æ›´æ–°ä¸Šä¸€ä¸ªé™€èºä»ª X è½´å€¼
  118   2        }
  119   1      }
  120          

C251 COMPILATION COMPLETE.  1 WARNING(S),  20 ERROR(S)
